import"./modulepreload-polyfill-B5Qt9EMX.js";import{initializeApp as A}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";import{getAuth as $,onAuthStateChanged as L,signOut as M}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js";import{getFirestore as v,doc as w,getDoc as C,collection as u,query as p,where as h,getDocs as f}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js";const H={apiKey:"AIzaSyCJdMdkW5NZF83PLBLYZk3yBAFsUxqautY",authDomain:"atpib-82d72.firebaseapp.com",projectId:"atpib-82d72",storageBucket:"atpib-82d72.firebasestorage.app",messagingSenderId:"938927546204",appId:"1:938927546204:web:ea096f1dfe3b3754dd6b99",measurementId:"G-G3BRPK5B9T"},x=A(H),l=$(x),d=v(x),y=document.getElementById("balance"),b=document.getElementById("welcome-name"),r=document.getElementById("history-container"),c=document.getElementById("pending-container");L(l,async e=>{if(console.log("Current user:",e),e){console.log("User is logged in:",e.uid),console.log("Current user:",e);const a=w(d,"users",e.uid),n=await C(a);if(console.log("User document exists:",n.exists()),n.exists()){console.log("User data:",n.data());const s=n.data(),N=s.wallet||0;y?y.textContent=`$${parseFloat(N).toFixed(2)}`:console.warn("Balance element not found in the DOM"),b&&(b.textContent=s.firstName?`Welcome back, ${s.firstName}`:"Welcome, User");const E=u(d,"history"),B=p(E,h("userId","==",e.uid)),m=await f(B);if(r)if(r.innerHTML="",!m.empty)m.forEach(t=>{const i=t.data(),o=document.createElement("div");o.className="bg-white p-4 rounded-lg shadow-md text-center",o.innerHTML=`
                                    <h3 class="font-semibold text-gray-800">${i.description||"No description"}</h3>
                                    <p class="text-gray-600">$${i.amount||""}</p>
                                `,r.appendChild(o)});else{const t=document.createElement("div");t.className="bg-white p-4 rounded-lg shadow-md text-center",t.innerHTML='<h3 class="font-semibold text-gray-800">No history</h3>',r.appendChild(t)}const I=u(d,"pending"),D=p(I,h("userId","==",e.uid)),g=await f(D);if(c)if(c.innerHTML="",!g.empty)g.forEach(t=>{const i=t.data(),o=document.createElement("div");o.className="bg-white p-4 rounded-lg shadow-md text-center",o.innerHTML=`
                                    <h3 class="font-semibold text-gray-800">${i.description||"No description"}</h3>
                                    <p class="text-gray-600">$${i.amount||""}</p>
                                `,c.appendChild(o)});else{const t=document.createElement("div");t.className="bg-white p-4 rounded-lg shadow-md text-center",t.innerHTML='<h3 class="font-semibold text-gray-800">No pending transactions</h3>',c.appendChild(t)}}else console.log("No user document found in Firestore."),alert("No user data found.")}else console.log("No user signed in, redirecting to sign-in page."),window.location.href="login.html"});window.signOut=function(){M(l).then(()=>{alert("Signed out successfully!"),window.location.href="login.html"}).catch(e=>{alert("Error signing out: "+e.message)})};l.onAuthStateChanged(async e=>{if(console.log("Current user:",e),e)try{const a=w(d,"users",e.uid),n=await C(a);if(n.exists()){const s=n.data();document.getElementById("account-name").textContent=s.name||"Not Available"}else console.error("No user document found!"),document.getElementById("account-name").textContent="Not Available"}catch(a){console.error("Error fetching user data:",a),document.getElementById("account-name").textContent="Error loading name"}else console.error("User not signed in"),document.getElementById("account-name").textContent="Not Available"});
