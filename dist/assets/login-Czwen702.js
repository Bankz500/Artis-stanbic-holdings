import"./modulepreload-polyfill-B5Qt9EMX.js";import"./index.esm-BeIn6wDe.js";import"https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";import{signInWithEmailAndPassword as c}from"https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";import{initializeApp as g}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";import{getAuth as u,signInWithEmailAndPassword as p}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js";const f=(n,e)=>{const t=document.getElementById("login-btn");t.disabled=!0,t.textContent="Logging in...",c(auth,n,e).then(o=>{const a=o.user;console.log("User logged in:",a),window.location.href="otp.html"}).catch(o=>{const a=o.code,l=o.message;console.error("Error during login:",a,l),t.disabled=!1,t.textContent="Log In",alert("Invalid email or password. Please try again.")})};document.querySelector("form").addEventListener("submit",n=>{n.preventDefault();const e=document.getElementById("email").value,t=document.getElementById("password").value;f(e,t)});const y={apiKey:"AIzaSyCJdMdkW5NZF83PLBLYZk3yBAFsUxqautY",authDomain:"atpib-82d72.firebaseapp.com",projectId:"atpib-82d72",storageBucket:"atpib-82d72.firebasestorage.app",messagingSenderId:"938927546204",appId:"1:938927546204:web:ea096f1dfe3b3754dd6b99",measurementId:"G-G3BRPK5B9T"},I=g(y),w=u(I);emailjs.init("N9MvCEIIhbWSHAM1D");const h=document.getElementById("login-section"),E=document.getElementById("otp-section"),b=document.getElementById("login-form"),v=document.getElementById("otp-form"),r=document.getElementById("login-btn"),s=document.getElementById("resend-otp"),B=document.getElementById("email-display");let i=null;function d(n=6){return Array.from({length:n},()=>Math.floor(Math.random()*10)).join("")}async function m(n,e){try{return await emailjs.send("service_f2t3rz7","template_n4a50om",{email:n,otp:e}),!0}catch(t){return console.error("Error sending OTP:",t),!1}}b.addEventListener("submit",async n=>{n.preventDefault();const e=document.getElementById("email").value.trim(),t=document.getElementById("password").value;try{r.disabled=!0,r.textContent="Authenticating...",i=(await p(w,e,t)).user;const a=d();if(sessionStorage.setItem("loginOtp",a),!await m(e,a))throw new Error("Failed to send OTP");B.textContent=e,h.classList.add("hidden"),E.classList.remove("hidden")}catch(o){console.error("Login error:",o);let a="An error occurred during login.";o.code==="auth/user-not-found"||o.code==="auth/wrong-password"?a="Invalid email or password.":o.code==="auth/too-many-requests"&&(a="Too many failed attempts. Please try again later."),alert(a)}finally{r.disabled=!1,r.textContent="Log in"}});v.addEventListener("submit",async n=>{n.preventDefault();const e=document.getElementById("otp").value,t=sessionStorage.getItem("loginOtp");if(!t){alert("OTP session expired. Please login again."),window.location.reload();return}e===t?(sessionStorage.removeItem("loginOtp"),window.location.href="dashboard.html"):alert("Invalid OTP. Please try again.")});s.addEventListener("click",async n=>{if(n.preventDefault(),!i){alert("Session expired. Please login again."),window.location.reload();return}s.textContent="Sending...";const e=d();await m(i.email,e)?(sessionStorage.setItem("loginOtp",e),alert("New OTP has been sent to your email.")):alert("Failed to send new OTP. Please try again."),s.textContent="Request again"});sessionStorage.removeItem("loginOtp");
