import"./modulepreload-polyfill-B5Qt9EMX.js";import{initializeApp as $}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-app.js";import{getAuth as U,onAuthStateChanged as A,signOut as L}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-auth.js";import{getFirestore as M,doc as C,getDoc as N,collection as p,query as h,where as f,getDocs as y}from"https://www.gstatic.com/firebasejs/9.1.3/firebase-firestore.js";const H={apiKey:"AIzaSyCJdMdkW5NZF83PLBLYZk3yBAFsUxqautY",authDomain:"atpib-82d72.firebaseapp.com",projectId:"atpib-82d72",storageBucket:"atpib-82d72.firebasestorage.app",messagingSenderId:"938927546204",appId:"1:938927546204:web:ea096f1dfe3b3754dd6b99",measurementId:"G-G3BRPK5B9T"},b=$(H),m=U(b),l=M(b),w=document.getElementById("balance"),x=document.getElementById("name"),c=document.getElementById("history-container"),d=document.getElementById("pending-container");A(m,async e=>{if(console.log("Current user:",e),e){console.log("User is logged in:",e.uid),console.log("Current user:",e);const a=C(l,"users",e.uid),o=await N(a);if(console.log("User document exists:",o.exists()),o.exists()){console.log("User data:",o.data());const n=o.data(),r=n.wallet||0;w?w.textContent=`$${parseFloat(r).toFixed(2)}`:console.warn("Balance element not found in the DOM"),x&&(x.textContent=n.firstName?`, ${n.firstName}`:", User");const E=p(l,"history"),B=h(E,f("userId","==",e.uid)),g=await y(B);if(c)if(c.innerHTML="",!g.empty)g.forEach(t=>{const i=t.data(),s=document.createElement("div");s.className="bg-white p-4 rounded-lg shadow-md text-center",s.innerHTML=`
                                    <h3 class="font-semibold text-gray-800">${i.description||"No description"}</h3>
                                    <p class="text-gray-600">$${i.amount||""}</p>
                                `,c.appendChild(s)});else{const t=document.createElement("div");t.className="bg-white p-4 rounded-lg shadow-md text-center",t.innerHTML='<h3 class="font-semibold text-gray-800">No history</h3>',c.appendChild(t)}const I=p(l,"pending"),D=h(I,f("userId","==",e.uid)),u=await y(D);if(d)if(d.innerHTML="",!u.empty)u.forEach(t=>{const i=t.data(),s=document.createElement("div");s.className="bg-white p-4 rounded-lg shadow-md text-center",s.innerHTML=`
                                    <h3 class="font-semibold text-gray-800">${i.description||"No description"}</h3>
                                    <p class="text-gray-600">$${i.amount||""}</p>
                                `,d.appendChild(s)});else{const t=document.createElement("div");t.className="bg-white p-4 rounded-lg shadow-md text-center",t.innerHTML='<h3 class="font-semibold text-gray-800">No pending transactions</h3>',d.appendChild(t)}}else console.log("No user document found in Firestore."),alert("No user data found.")}else console.log("No user signed in, redirecting to sign-in page."),window.location.href="login.html"});window.signOut=function(){L(m).then(()=>{alert("Signed out successfully!"),window.location.href="login.html"}).catch(e=>{alert("Error signing out: "+e.message)})};m.onAuthStateChanged(async e=>{if(console.log("Current user:",e),e)try{const a=C(l,"users",e.uid),o=await N(a);if(console.log("User document exists:",o.exists()),o.exists()){const n=o.data();console.log("User data:",n);const r=document.getElementById("account-name");r&&(r.textContent=n.firstName&&n.lastName?` ${n.firstName} ${n.lastName}`:"Welcome, User")}else console.error("No user document found!"),document.getElementById("account-name").textContent="Not Available"}catch(a){console.error("Error fetching user data:",a),document.getElementById("account-name").textContent="Error loading name"}else console.error("User not signed in"),document.getElementById("account-name").textContent="Not Available"});
